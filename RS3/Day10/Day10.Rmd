---
title: "Day10"
author: "Amrit Singh"
date: "2025-10-14"
output:
  word_document: default
  html_document: default
---

```{r}
library(readr)
library(ggplot2)
library(dplyr)
library(car)
library(leaps)
library(olsrr)

HighPeaks <- read_csv("HighPeaks.csv")
head(HighPeaks)
MLBStandings2016 <- read_csv("MLBStandings2016.csv")
head(MLBStandings2016)

#4.2 
#a)
ggplot(HighPeaks, aes(x = Elevation, y = Time)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Scatterplot of Hike Time vs Elevation",
       x = "Elevation (ft)",
       y = "Time (hours)")
correlation <- cor(HighPeaks$Elevation, HighPeaks$Time, use = "complete.obs")
print(paste("Correlation between Elevation and Time:", correlation))
# The correlation between the variables is -0.016, which is extremely weak, and the scatterplot shows no visible pattern, meaning Elevation does not predict time effectively.

#b)
model1 <- lm(Time ~ Elevation + Length, data = HighPeaks)
summary(model1)
# Both p-values are low, indicating that each predictor plays a meaningful role in explaining time.

#c)
avPlots(model1, ask = FALSE)
# Yes, it indicates a negative linear trend, meaning that after adjusting for length, Elevation becomes a useful predictor of time.

#4.3 
#a)
model_null <- lm(WinPct ~ 1, data = MLBStandings2016)
model_full <- lm(WinPct ~ BattingAverage + Runs + Hits + HR + Doubles + Triples + RBI + SB + OBP + SLG + ERA + HitsAllowed + Walks + StrikeOuts + Saves + WHIP, data = MLBStandings2016)
model_forward <- step(model_null, scope = list(lower = model_null, upper = model_full), direction = "forward", steps = 4, trace = TRUE)
summary(model_forward)
# R^2 = 0.8863
# Predictors are ERA + Runs + Saves + WHIP

#b)
model_backward <- step(model_full, direction = "backward", trace = TRUE)
while((length(coef(model_backward)) - 1) > 4) {
  pvals <- summary(model_backward)$coefficients[-1, 4]
  var_remove <- names(which.max(pvals))
  current_vars <- names(coef(model_backward))[-1]
  new_vars <- setdiff(current_vars, var_remove)
  model_backward <- lm(as.formula(paste("WinPct ~", paste(new_vars, collapse = " + "))), data = MLBStandings2016)
}
summary(model_backward)
# R^2 = 0.8836
# Predictors are BattingAverage + Runs + Saves + WHIP

#c)
best_sub <- regsubsets(WinPct ~ BattingAverage + Runs + Hits + HR + Doubles + Triples + RBI + SB + OBP + SLG + ERA + HitsAllowed + Walks + StrikeOuts + Saves + WHIP, 
                       data = MLBStandings2016, nvmax = 16)
best_sub_sum <- summary(best_sub)
four_idx <- which(rowSums(best_sub_sum$which) == 5)
era_idx <- four_idx[ best_sub_sum$which[four_idx, "ERA"] == TRUE ]
if(length(era_idx) > 0) {
  best_model_index <- era_idx[ which.max(best_sub_sum$adjr2[era_idx]) ]
} else {
  best_model_index <- four_idx[ which.max(best_sub_sum$adjr2[four_idx]) ]
}
model_coefs <- coef(best_sub, best_model_index)
print(names(model_coefs)[-1])
cat("R-squared:", best_sub_sum$rsq[best_model_index], "\n")
# R^2 = 0.8885
# Predictors are Runs + Doubles + Saves + WHIP

#d). 
ols_mallows_cp(model_forward, model_full)
ols_mallows_cp(model_backward, model_full)
best_sub_sum$cp[best_model_index]

#e).
# I would select the model from part c because it gives the highest R^2 and the lowest Mallows Cp


```